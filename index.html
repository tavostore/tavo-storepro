<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tavo Store | Cloud Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #09090b; color: #ffffff; margin: 0; }
        .glass-card { background: rgba(24, 24, 27, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); transition: all 0.3s ease; }
        .admin-input { background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 0.75rem; padding: 0.6rem 1rem; color: white; width: 100%; outline: none; font-size: 14px; }
        .admin-input:focus { border-color: #3b82f6; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s ease forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBQwVbcCO2GHCHKL5EoEOG9Jo3ZAXGAy2o",
            authDomain: "tavostore-4dedf.firebaseapp.com",
            projectId: "tavostore-4dedf",
            storageBucket: "tavostore-4dedf.firebasestorage.app",
            messagingSenderId: "265905383641",
            appId: "1:265905383641:web:92499c7fe2620f988f36c8"
        };

        const appId = "tavostore-main-app";
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.fb = { db, auth, appId, doc, setDoc, onSnapshot, updateDoc, collection, getDocs, signInAnonymously, onAuthStateChanged };
    </script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('store');
            const [isLogged, setIsLogged] = useState(false);
            const [data, setData] = useState({ rate: 62, settings: { logo: "TAVO STORE", whatsapp: "584249649769", banner: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2000" }, products: [] });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                window.fb.signInAnonymously(window.fb.auth).catch(console.error);
                window.fb.onAuthStateChanged(window.fb.auth, setUser);
            }, []);

            useEffect(() => {
                if (!user) return;

                // 1. Escuchar Configuraci칩n (Tasa, Logo, etc)
                const settingsRef = window.fb.doc(window.fb.db, 'artifacts', window.fb.appId, 'public', 'data', 'configuracion', 'general');
                const unsubsSettings = window.fb.onSnapshot(settingsRef, (docSnap) => {
                    if (docSnap.exists()) {
                        setData(prev => ({ ...prev, ...docSnap.data() }));
                    } else {
                        window.fb.setDoc(settingsRef, { rate: 62, settings: data.settings });
                    }
                });

                // 2. Escuchar Productos
                const productsRef = window.fb.collection(window.fb.db, 'artifacts', window.fb.appId, 'public', 'data', 'productos');
                const unsubsProducts = window.fb.onSnapshot(productsRef, (snap) => {
                    const prods = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    setData(prev => ({ ...prev, products: prods }));
                    setLoading(false);
                });

                return () => { unsubsSettings(); unsubsProducts(); };
            }, [user]);

            if (loading) return <div className="h-screen flex items-center justify-center bg-[#09090b] text-blue-500 font-black uppercase tracking-widest animate-pulse">Cargando Tavo Store...</div>;

            const formatBs = (usd) => (usd * data.rate).toLocaleString('es-VE', { minimumFractionDigits: 2 });

            const StoreView = () => (
                <div className="fade-in pb-20">
                    <header className="relative h-[40vh] flex items-center justify-center overflow-hidden">
                        <img src={data.settings.banner} className="absolute inset-0 w-full h-full object-cover opacity-20" />
                        <div className="relative z-10 text-center">
                            <h1 className="text-6xl md:text-8xl font-black italic uppercase tracking-tighter">{data.settings.logo}</h1>
                            <div className="mt-4 bg-blue-600/20 border border-blue-500/30 px-4 py-1 rounded-full inline-block">
                                <span className="text-[10px] font-bold text-blue-400">Tasa: Bs. {data.rate}</span>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-8 -mt-10 relative z-20">
                        {data.products.map(p => (
                            <div key={p.id} className="glass-card rounded-[2rem] overflow-hidden">
                                <img src={p.img || 'https://placehold.co/400x500/000/fff?text=Producto'} className="w-full aspect-[4/5] object-cover" />
                                <div className="p-6">
                                    <h3 className="text-xl font-bold mb-4">{p.name}</h3>
                                    <div className="flex justify-between items-end">
                                        <div>
                                            <p className="text-3xl font-black italic">${p.price}</p>
                                            <p className="text-[10px] text-zinc-500 font-bold uppercase">Bs. {formatBs(p.price)}</p>
                                        </div>
                                        <button onClick={() => window.open(`https://wa.me/${data.settings.whatsapp}?text=Me interesa el ${p.name}`)} className="bg-white text-black px-6 py-2 rounded-xl font-black text-[10px] uppercase">Comprar</button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const AdminView = () => {
                const [pass, setPass] = useState("");
                if (!isLogged) return (
                    <div className="h-screen flex items-center justify-center">
                        <div className="glass-card p-10 rounded-[2rem] text-center w-80">
                            <h2 className="text-[10px] font-black uppercase mb-6 text-zinc-500">Panel de Control</h2>
                            <input type="password" placeholder="Clave" className="admin-input mb-4 text-center" onChange={e => setPass(e.target.value)} />
                            <button onClick={() => pass === "tavo2026" ? setIsLogged(true) : alert("Error")} className="w-full bg-blue-600 py-3 rounded-xl font-bold uppercase text-[10px]">Entrar</button>
                        </div>
                    </div>
                );

                const addProduct = async () => {
                    const id = "prod_" + Date.now();
                    await window.fb.setDoc(window.fb.doc(window.fb.db, 'artifacts', window.fb.appId, 'public', 'data', 'productos', id), { name: "Nuevo", price: 0, img: "", category: "Celulares", status: "stock" });
                };

                return (
                    <div className="max-w-3xl mx-auto p-10 fade-in pt-32">
                        <div className="flex justify-between items-center mb-10">
                            <h2 className="text-2xl font-black uppercase">Administraci칩n</h2>
                            <button onClick={addProduct} className="bg-blue-600 px-6 py-2 rounded-xl text-[10px] font-bold uppercase">A침adir Producto</button>
                        </div>

                        <div className="glass-card p-6 rounded-2xl mb-10 grid grid-cols-2 gap-4">
                            <div>
                                <label className="text-[9px] uppercase font-bold text-zinc-500 block mb-2">Tasa D칩lar</label>
                                <input type="number" className="admin-input" value={data.rate} onChange={e => window.fb.updateDoc(window.fb.doc(window.fb.db, 'artifacts', window.fb.appId, 'public', 'data', 'configuracion', 'general'), { rate: parseFloat(e.target.value) })} />
                            </div>
                            <div>
                                <label className="text-[9px] uppercase font-bold text-zinc-500 block mb-2">WhatsApp</label>
                                <input className="admin-input" value={data.settings.whatsapp} onChange={e => window.fb.updateDoc(window.fb.doc(window.fb.db, 'artifacts', window.fb.appId, 'public', 'data', 'configuracion', 'general'), { 'settings.whatsapp': e.target.value })} />
                            </div>
                        </div>

                        <div className="space-y-4">
                            {data.products.map(p => (
                                <div key={p.id} className="glass-card p-4 rounded-xl flex items-center gap-4">
                                    <input className="admin-input flex-1" value={p.name} onChange={e => window.fb.updateDoc(window.fb.doc(window.fb.db, 'artifacts', window.fb.appId, 'public', 'data', 'productos', p.id), { name: e.target.value })} />
                                    <input type="number" className="admin-input w-24" value={p.price} onChange={e => window.fb.updateDoc(window.fb.doc(window.fb.db, 'artifacts', window.fb.appId, 'public', 'data', 'productos', p.id), { price: parseFloat(e.target.value) })} />
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <>
                    <nav className="fixed top-0 w-full z-50 bg-black/60 backdrop-blur-md p-6 flex justify-between items-center border-b border-white/5">
                        <span className="font-black italic text-xl uppercase cursor-pointer" onClick={() => setView('store')}>{data.settings.logo}</span>
                        <button onClick={() => setView(view === 'admin' ? 'store' : 'admin')} className="text-[9px] font-bold uppercase border border-white/10 px-4 py-2 rounded-full">{view === 'admin' ? 'Tienda' : 'Admin'}</button>
                    </nav>
                    {view === 'store' ? <StoreView /> : <AdminView />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

